import React, { useState } from 'react';

// ë©”ì¸ App ì»´í¬ë„ŒíŠ¸
const App = () => {
    // ì‚¬ìš©ì ì…ë ¥ í•„ê¸°
    const [inputText, setInputText] = useState('');
    // ì„ íƒëœ ì–´íˆ¬
    const [selectedTone, setSelectedTone] = useState('ì¹œê·¼í•˜ê³  ìºì£¼ì–¼í•œ ì–´íˆ¬');
    // ì„ íƒëœ êµ¬ì¡°
    const [selectedStructure, setSelectedStructure] = useState('ì„œë¡ -ë³¸ë¡ -ê²°ë¡ ');
    // ìƒì„±ëœ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ê¸€
    const [generatedPost, setGeneratedPost] = useState('');
    // ë¡œë”© ìƒíƒœ (API í˜¸ì¶œ ì¤‘ì¸ì§€ ì—¬ë¶€)
    const [isLoading, setIsLoading] = useState(false);
    // ì—ëŸ¬ ë©”ì‹œì§€
    const [error, setError] = useState('');
    // Google API Key ìƒíƒœ ì¶”ê°€
    const [googleApiKey, setGoogleApiKey] = useState('');

    // ì–´íˆ¬ ì˜µì…˜ ì •ì˜
    const toneOptions = [
        'ì¹œê·¼í•˜ê³  ìºì£¼ì–¼í•œ ì–´íˆ¬',
        'ì „ë¬¸ì ì´ê³  ì •ë³´ ì „ë‹¬ ìœ„ì£¼',
        'ê°ì„±ì ì´ê³  ì„œì •ì ì¸ ì–´íˆ¬',
        'ì¬ë¯¸ìˆê³  ìœ ë¨¸ëŸ¬ìŠ¤í•œ ì–´íˆ¬',
        'ê°„ê²°í•˜ê³  ëª…ë£Œí•œ ì–´íˆ¬'
    ];

    // êµ¬ì¡° ì˜µì…˜ ì •ì˜
    const structureOptions = [
        'ì„œë¡ -ë³¸ë¡ -ê²°ë¡ ',
        'í•µì‹¬ ìš”ì•½ í›„ ìƒì„¸ ì„¤ëª…',
        'ì§ˆë¬¸-ë‹µë³€ í˜•ì‹',
        'ëª©ë¡(ë¦¬ìŠ¤íŠ¸) í˜•ì‹',
        'ììœ  í˜•ì‹'
    ];

    // Gemini APIë¥¼ í˜¸ì¶œí•˜ì—¬ ê²Œì‹œë¬¼ ìƒì„±
    const generatePost = async () => {
        setIsLoading(true); // ë¡œë”© ì‹œì‘
        setError(''); // ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
        setGeneratedPost(''); // ê¸°ì¡´ ìƒì„±ë¬¼ ì´ˆê¸°í™”

        // API í‚¤ ìœ íš¨ì„± ê²€ì‚¬
        if (!googleApiKey.trim()) {
            setError("Google API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            setIsLoading(false);
            return;
        }

        // LLMì— ì „ë‹¬í•  í”„ë¡¬í”„íŠ¸ êµ¬ì„±
        const prompt = `
ë‹¹ì‹ ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ê²Œì‹œë¬¼ ì‘ì„± ì „ë¬¸ AIì…ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ê²Œì‹œë¬¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.
ì‚¬ìš©ìì˜ í•„ê¸°:
"${inputText}"

ë‹¤ìŒ ì¡°ê±´ì— ë§ì¶° ê¸€ì„ ê°€ê³µí•´ì£¼ì„¸ìš”:
- ì–´íˆ¬: ${selectedTone}
- êµ¬ì¡°: ${selectedStructure}

ê²°ê³¼ë¬¼ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œì— ë°”ë¡œ ê²Œì‹œí•  ìˆ˜ ìˆë„ë¡ ìì—°ìŠ¤ëŸ½ê³  ë§¤ë ¥ì ì¸ í•œêµ­ì–´ ë¬¸ì²´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ë¶ˆí•„ìš”í•œ ì„œë¡ /ê²°ë¡  ë¬¸êµ¬ ì—†ì´ ì¸ìŠ¤íƒ€ê·¸ë¨ ë³¸ë¬¸ë§Œ ì‘ì„±í•´ ì£¼ì„¸ìš”. (ì˜ˆ: "ì•ˆë…•í•˜ì„¸ìš”!", "ê°ì‚¬í•©ë‹ˆë‹¤!" ë“± ì œì™¸)
`;

        try {
            // API í‚¤ë¥¼ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ìœ¼ë¡œ ì„¤ì •
            const apiKey = googleApiKey.trim();
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            // ì‘ë‹µ êµ¬ì¡° í™•ì¸ ë° í…ìŠ¤íŠ¸ ì¶”ì¶œ
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                setGeneratedPost(text); // ìƒì„±ëœ í…ìŠ¤íŠ¸ ì €ì¥
            } else {
                // ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ êµ¬ì¡° ë˜ëŠ” ë‚´ìš© ëˆ„ë½ ì²˜ë¦¬
                console.error("Unexpected API response structure:", result);
                setError("ê²Œì‹œë¬¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API ì‘ë‹µì„ í™•ì¸í•˜ê±°ë‚˜ API í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        } catch (err) {
            console.error("Error generating post:", err);
            setError("API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ API í‚¤ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.");
        } finally {
            setIsLoading(false); // ë¡œë”© ì¢…ë£Œ
        }
    };

    // í´ë¦½ë³´ë“œì— í…ìŠ¤íŠ¸ ë³µì‚¬
    const copyToClipboard = () => {
        if (generatedPost) {
            // document.execCommand('copy')ëŠ” iFrame í™˜ê²½ì—ì„œ ë” ì•ˆì •ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            const textarea = document.createElement('textarea');
            textarea.value = generatedPost;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
            } catch (err) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            }
            document.body.removeChild(textarea);
        }
    };

    return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center justify-center p-4 sm:p-6 lg:p-8 font-sans">
            <style>
                {`
                @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
                body {
                    font-family: 'Inter', sans-serif;
                }
                `}
            </style>
            <div className="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-4xl border border-gray-200">
                <h1 className="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">
                    âœ¨ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ìë™ ì‘ì„±ê¸° âœ¨
                </h1>

                {/* Google API Key ì…ë ¥ ì„¹ì…˜ ì¶”ê°€ */}
                <div className="mb-8">
                    <label htmlFor="google-api-key" className="block text-lg font-medium text-gray-700 mb-2">
                        ğŸ”‘ Google API Key ì…ë ¥
                    </label>
                    <input
                        id="google-api-key"
                        type="password" // ë³´ì•ˆì„ ìœ„í•´ password íƒ€ì…ìœ¼ë¡œ ì„¤ì •
                        className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out text-base"
                        placeholder="ì—¬ê¸°ì— Google Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
                        value={googleApiKey}
                        onChange={(e) => setGoogleApiKey(e.target.value)}
                    />
                     <p className="text-sm text-gray-500 mt-2">
                        API í‚¤ëŠ” ë¯¼ê°í•œ ì •ë³´ì´ë¯€ë¡œ ì£¼ì˜í•˜ì—¬ ê´€ë¦¬í•´ì£¼ì„¸ìš”.
                    </p>
                </div>

                {/* ì…ë ¥ ì„¹ì…˜ */}
                <div className="mb-8">
                    <label htmlFor="input-text" className="block text-lg font-medium text-gray-700 mb-2">
                        âœï¸ í•„ê¸° ì…ë ¥ (ëŒ€ì¶© ì ì–´ë„ ê´œì°®ì•„ìš”!)
                    </label>
                    <textarea
                        id="input-text"
                        className="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out resize-y min-h-[150px] text-base"
                        placeholder="ì—¬ê¸°ì— ì¸ìŠ¤íƒ€ê·¸ë¨ ê²Œì‹œë¬¼ë¡œ ë§Œë“¤ê³  ì‹¶ì€ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”. (ì˜ˆ: ì˜¤ëŠ˜ ê°•ì•„ì§€ë‘ ì‚°ì±…í–ˆëŠ”ë° ë„ˆë¬´ ê·€ì—¬ì› ê³  ë‚ ì”¨ë„ ì¢‹ì•˜ì–´! íë§ ê·¸ ìì²´)"
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                    ></textarea>
                </div>

                {/* ì˜µì…˜ ì„ íƒ ì„¹ì…˜ */}
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label htmlFor="tone-select" className="block text-lg font-medium text-gray-700 mb-2">
                            ğŸ—£ï¸ ì–´íˆ¬ ì„ íƒ
                        </label>
                        <select
                            id="tone-select"
                            className="w-full p-3 border border-gray-300 rounded-lg bg-white appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out text-base"
                            value={selectedTone}
                            onChange={(e) => setSelectedTone(e.target.value)}
                        >
                            {toneOptions.map((tone) => (
                                <option key={tone} value={tone}>
                                    {tone}
                                </option>
                            ))}
                        </select>
                    </div>

                    <div>
                        <label htmlFor="structure-select" className="block text-lg font-medium text-gray-700 mb-2">
                            ğŸ“ êµ¬ì¡° ì„ íƒ
                        </label>
                        <select
                            id="structure-select"
                            className="w-full p-3 border border-gray-300 rounded-lg bg-white appearance-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out text-base"
                            value={selectedStructure}
                            onChange={(e) => setSelectedStructure(e.target.value)}
                        >
                            {structureOptions.map((structure) => (
                                <option key={structure} value={structure}>
                                    {structure}
                                </option>
                            ))}
                        </select>
                    </div>
                </div>

                {/* ìƒì„± ë²„íŠ¼ */}
                <button
                    onClick={generatePost}
                    // API í‚¤, ì…ë ¥ í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆê±°ë‚˜ ë¡œë”© ì¤‘ì¼ ë•Œ ë²„íŠ¼ ë¹„í™œì„±í™”
                    disabled={isLoading || !inputText.trim() || !googleApiKey.trim()}
                    className={`w-full py-4 px-6 rounded-xl font-semibold text-lg transition-all duration-300 ease-in-out
                        ${isLoading || !inputText.trim() || !googleApiKey.trim()
                            ? 'bg-gradient-to-r from-blue-400 to-blue-300 text-white cursor-not-allowed opacity-70'
                            : 'bg-gradient-to-r from-blue-600 to-blue-500 text-white shadow-lg hover:from-blue-700 hover:to-blue-600 active:scale-98'
                        }
                    `}
                >
                    {isLoading ? (
                        <div className="flex items-center justify-center">
                            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            ìƒì„± ì¤‘...
                        </div>
                    ) : (
                        'ğŸš€ ì¸ìŠ¤íƒ€ê·¸ë¨ ê²Œì‹œë¬¼ ìƒì„±í•˜ê¸°'
                    )}
                </button>

                {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
                {error && (
                    <div className="mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-center font-medium">
                        {error}
                    </div>
                )}

                {/* ìƒì„±ëœ ê²Œì‹œë¬¼ ì¶œë ¥ ì„¹ì…˜ */}
                {generatedPost && (
                    <div className="mt-8 pt-8 border-t border-gray-200">
                        <label className="block text-lg font-medium text-gray-700 mb-2">
                            ğŸ‰ ì™„ì„±ëœ ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ ê¸€
                        </label>
                        <div className="relative p-5 bg-blue-50 rounded-lg border border-blue-200 text-gray-800 break-words whitespace-pre-wrap min-h-[100px] text-base">
                            {generatedPost}
                        </div>
                        <button
                            onClick={copyToClipboard}
                            className="mt-4 w-full py-3 px-6 rounded-xl font-semibold text-md bg-green-500 text-white shadow-md hover:bg-green-600 transition duration-200 ease-in-out active:scale-98"
                        >
                            ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬
                        </button>
                    </div>
                )}
            </div>
        </div>
    );
};

export default App;
